## 简单的PHP文件服务器



#### 项目简介

该文件夹为外链服务器 PHP 程序源码。该程序易于部署，支持主流 PHP 版本，使用 SQLite 数据库，程序将用户上传的保存到 ./uploads 文件夹中。

可以看作简单的 PHP 网盘，不仅可以使用浏览器上传，还可以通过 API 进行文件的上传和操作。使用 SQLite 保存上传的文件列表，从而实现文件的管理。



#### 网页管理页面

API密钥（code）是静态的，存储在 config.php 中的 $code_from_api 变量中，需要按需修改。

接口地址：/admin.php

| uid   | filename                                                     | original_name | size    | create_time         | update_time         | operation |
| ----- | ------------------------------------------------------------ | ------------- | ------- | ------------------- | ------------------- | --------- |
| 10000 | [5a5b9ce2b404a799ee8c6d8499d79cea.pkl](http://127.0.0.1:8080/uploads/5a5b9ce2b404a799ee8c6d8499d79cea.pkl) | weather.pkl   | 9894988 | 2021-02-21 05:30:22 | 2021-02-21 05:30:22 | 删除      |



#### 接口信息

##### 上传文件

接口地址：/upload.php

请求方式：POST

请求参数：

| 名称 | 类型 | 必填 | 说明                         |
| ---- | ---- | ---- | ---------------------------- |
| file | file | 是   | 要上传的文件，大小不超过100M |
| uid  | int  | 是   | 用户ID                       |
| code | int  | 是   | 校验码                       |

返回参数：

| HTTP状态码 | 返回json中，msg的值                         | 说明 |
| ---------- | ------------------------------------------- | ---- |
| 200        | 上传成功\|请使用POST请求                    |      |
| 403        | 请使用POST请求\|缺少uid\|缺少code\|code无效 |      |
| 500        | 服务器剩余空间不足\|图片保存失败\|上传失败  |      |

```json
{
	"code": 200,
	"msg": "上传成功",
	"data": {
		"url": "http://127.0.0.1:8080/uploads/5a5b9ce2b404a799ee8c6d8499d79cea.pkl",
		"origin": "weather.pkl",
		"type": "application/octet-stream",
		"size": 9894988
	}
}
```

##### 删除文件

接口地址：/delete.php

请求方式：POST

请求参数：

| 名称     | 类型   | 必填 | 说明                                                    |
| -------- | ------ | ---- | ------------------------------------------------------- |
| filename | string | 是   | 要删除的文件名，如 5a5b9ce2b404a799ee8c6d8499d79cea.pkl |
| code     | int    | 是   | 校验码                                                  |

返回参数：

| HTTP状态码 | 返回json中，msg的值                            | 说明 |
| ---------- | ---------------------------------------------- | ---- |
| 200        | 文件删除成功\|请使用POST请求                   |      |
| 403        | 请使用POST请求\|缺少code\|code无效\|文件不存在 |      |
| 500        | 文件删除失败                                   |      |



#### 文件目录

├─files
│  │  admin.php	文件管理程序
│  │  config.php	配置文件，如文件目录，密码等
│  │  database.php	数据库操作程序
│  │  delete.php	删除文件程序
│  │  index.php	交互测试页面
│  │  upload.php	上传文件程序
│  │
│  └─uploads	文件保存目录
│          index.html	占位首页





 